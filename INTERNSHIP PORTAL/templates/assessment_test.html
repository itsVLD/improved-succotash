<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="{{ url_for('static', filename='main_menu/menu.css') }}" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Assessment Test | Internship Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .option-button {
      transition: background-color 0.3s, color 0.3s;
    }
    .option-button.selected {
      background-color: #2563eb; /* blue-600 */
      color: white;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-6 font-sans text-gray-900">
<aside class="sidebar">
  <div class="brand">
    <i class="fa-solid fa-briefcase"></i>
    <span>Internship Portal</span>
  </div>
  <nav>
    <ul>
      <li><a href="/dashboard"><i class="fa-solid fa-house"></i> Dashboard</a></li>
      <li><a href="/profile"><i class="fa-solid fa-user"></i> Profile</a></li>
      <li><a href="/assessment"><i class="fa-solid fa-clipboard-list"></i> Assessment Test</a></li>
      <li><a href="/applications"><i class="fa-solid fa-folder-open"></i> Application Management</a></li>
      <li><a href="/private_internships"><i class="fa-solid fa-user-lock"></i> Private Internships</a></li>
      <li><a href="/government_internships"><i class="fa-solid fa-building-columns"></i> Government Internships</a></li>
      <li><a href="/feedback"><i class="fa-solid fa-star"></i> Feedback</a></li>
      <li><a href="/logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
    </ul>
  </nav>
</aside>
  <div class="max-w-4xl mx-auto">

    <h1 class="text-3xl font-bold mb-8 border-b-2 border-blue-600 pb-2">Assessment Tests</h1>

    <!-- Test List -->
    <div id="test-list" class="space-y-6">
      <!-- Tests dynamically inserted here -->
    </div>

    <!-- Test Taking Section (hidden initially) -->
    <div id="test-section" class="hidden bg-white p-8 rounded-lg shadow-lg mt-8">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-semibold" id="test-title"></h2>
        <div class="text-right">
          <span class="font-mono text-lg" id="timer">00:00</span>
        </div>
      </div>

      <div id="question-container" class="space-y-6">
        <!-- Questions here -->
      </div>

      <div class="mt-6 flex justify-between">
        <button id="prev-btn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" disabled>Previous</button>
        <button id="next-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
      </div>

      <div class="mt-6 flex justify-end">
        <button id="submit-btn" class="bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700 hidden">Submit Test</button>
      </div>

    </div>

    <!-- Test Results Section -->
    <div id="result-section" class="hidden bg-white p-8 rounded-lg shadow-lg mt-8">
      <h2 class="text-2xl font-semibold mb-4">Test Results</h2>
      <p class="mb-2">Your score: <span id="score"></span> / <span id="total-questions"></span></p>
      <div id="result-details" class="space-y-4">
        <!-- Question by question result -->
      </div>
      <button onclick="restartTest()" class="mt-6 bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700">
        Back to Tests
      </button>
    </div>

  </div>

  <script>
    // Sample tests with questions and options
    const tests = [
      {
        id: 1,
        title: "Internship Aptitude Test",
        duration_minutes: 1, // For demo, 1 minute timer
        questions: [
          {
            id: 1,
            text: "Which language is primarily used for web development?",
            options: [
              {id: 'a', text: "Python"},
              {id: 'b', text: "JavaScript"},
              {id: 'c', text: "C++"},
              {id: 'd', text: "Java"}
            ],
            correct: 'b'
          },
          {
            id: 2,
            text: "Which data structure uses FIFO principle?",
            options: [
              {id: 'a', text: "Stack"},
              {id: 'b', text: "Queue"},
              {id: 'c', text: "Graph"},
              {id: 'd', text: "Tree"}
            ],
            correct: 'b'
          },
          {
            id: 3,
            text: "What is 2 + 2 * 3?",
            options: [
              {id: 'a', text: "8"},
              {id: 'b', text: "12"},
              {id: 'c', text: "10"},
              {id: 'd', text: "6"}
            ],
            correct: 'a'
          }
        ]
      }
      // Add more tests as needed
    ];

    let currentTest = null;
    let currentQuestionIndex = 0;
    let userAnswers = {};
    let timerInterval = null;
    let timeLeft = 0;

    const testListEl = document.getElementById('test-list');
    const testSectionEl = document.getElementById('test-section');
    const resultSectionEl = document.getElementById('result-section');

    function init() {
      tests.forEach(test => {
        const card = document.createElement('div');
        card.className = "bg-white p-6 rounded-md shadow hover:shadow-lg cursor-pointer";
        card.innerHTML = `
          <h3 class="text-xl font-semibold">${test.title}</h3>
          <p class="mt-1">Duration: <strong>${test.duration_minutes} ${test.duration_minutes > 1 ? 'minutes' : 'minute'}</strong></p>
          <button class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Start Test</button>
        `;
        card.querySelector('button').addEventListener('click', () => startTest(test.id));
        testListEl.appendChild(card);
      });
    }

    function startTest(testId) {
      currentTest = tests.find(t => t.id === testId);
      timeLeft = currentTest.duration_minutes * 60;
      userAnswers = {};
      currentQuestionIndex = 0;

      testListEl.classList.add('hidden');
      resultSectionEl.classList.add('hidden');
      testSectionEl.classList.remove('hidden');

      document.getElementById('test-title').innerText = currentTest.title;

      updateTimer();
      timerInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          submitTest();
        }
        updateTimer();
      }, 1000);

      renderQuestion();
      updateNavigationButtons();
      document.getElementById('submit-btn').classList.add('hidden');
    }

    function updateTimer() {
      const timerEl = document.getElementById('timer');
      const mins = Math.floor(timeLeft / 60).toString().padStart(2, '0');
      const secs = (timeLeft % 60).toString().padStart(2, '0');
      timerEl.innerText = `${mins}:${secs}`;
    }

    function renderQuestion() {
      const question = currentTest.questions[currentQuestionIndex];
      const container = document.getElementById('question-container');
      container.innerHTML = `
        <div>
          <p class="font-semibold text-lg mb-4">Q${currentQuestionIndex + 1}. ${question.text}</p>
          <div class="space-y-3">
            ${question.options.map(opt => `
              <button class="option-button block w-full border border-gray-300 rounded py-2 px-4 text-left ${userAnswers[question.id] === opt.id ? 'selected bg-blue-600 text-white' : ''}"
                data-opt="${opt.id}">
                ${opt.id.toUpperCase()}. ${opt.text}
              </button>
            `).join('')}
          </div>
        </div>
      `;

      // Add click listeners for options
      container.querySelectorAll('.option-button').forEach(btn => {
        btn.addEventListener('click', () => {
          userAnswers[question.id] = btn.getAttribute('data-opt');
          renderQuestion();
        });
      });
    }

    function updateNavigationButtons() {
      document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
      if (currentQuestionIndex === currentTest.questions.length - 1) {
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('submit-btn').classList.remove('hidden');
      } else {
        document.getElementById('next-btn').classList.remove('hidden');
        document.getElementById('submit-btn').classList.add('hidden');
      }
    }

    document.getElementById('prev-btn').addEventListener('click', () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
        updateNavigationButtons();
      }
    });

    document.getElementById('next-btn').addEventListener('click', () => {
      if (currentQuestionIndex < currentTest.questions.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
        updateNavigationButtons();
      }
    });

    document.getElementById('submit-btn').addEventListener('click', () => {
      clearInterval(timerInterval);
      submitTest();
    });

    function submitTest() {
      testSectionEl.classList.add('hidden');
      resultSectionEl.classList.remove('hidden');

      const totalQuestions = currentTest.questions.length;
      let score = 0;

      const resultDetailsEl = document.getElementById('result-details');
      resultDetailsEl.innerHTML = '';

      currentTest.questions.forEach(q => {
        const userAnswer = userAnswers[q.id] || 'No Answer';
        const isCorrect = userAnswer === q.correct;
        if (isCorrect) score++;

        const div = document.createElement('div');
        div.className = `p-4 rounded border ${isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`;
        div.innerHTML = `
          <p><strong>Q:</strong> ${q.text}</p>
          <p><strong>Your answer:</strong> ${userAnswer.toUpperCase()} ${userAnswer === 'No Answer' ? '' : '- ' + q.options.find(o=>o.id===userAnswer)?.text}</p>
          <p><strong>Correct answer:</strong> ${q.correct.toUpperCase()} - ${q.options.find(o=>o.id===q.correct).text}</p>
        `;
        resultDetailsEl.appendChild(div);
      });

      document.getElementById('score').innerText = score;
      document.getElementById('total-questions').innerText = totalQuestions;
    }

    function restartTest() {
      resultSectionEl.classList.add('hidden');
      testListEl.classList.remove('hidden');
      userAnswers = {};
      currentQuestionIndex = 0;
      currentTest = null;
    }

    // Initialize test list on page load
    init = () => {
      tests.length > 0 ? null : alert("No tests available");
      tests.forEach(test => {
        const card = document.createElement('div');
        card.className = "bg-white p-6 rounded-md shadow hover:shadow-lg cursor-pointer";
        card.innerHTML = `
          <h3 class="text-xl font-semibold">${test.title}</h3>
          <p class="mt-1">Duration: <strong>${test.duration_minutes} ${test.duration_minutes > 1 ? 'minutes' : 'minute'}</strong></p>
          <button class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Start Test</button>
        `;
        card.querySelector("button").addEventListener('click', () => startTest(test.id));
        testListEl.appendChild(card);
      });
    };

    // Run initialization
    init();

  </script>

</body>
</html>
